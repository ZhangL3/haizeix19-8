# 高级IO1

-磁盘写入过程
	- 缓冲
    - 为了弥补 cpu，内存，磁盘的速度差
    - 类型
      - 用户缓冲
      - 内核缓冲
      - 磁盘驱动器缓冲
	- 同步IO
    - 其他同步概念
      - 协议三要素
        - 语法，语义，同步(回应)
      - 线程同步
    - fsync
    - 缓冲 IO
      - 数据写入内核缓冲并返回
      - stdio
        - 缓冲机制
          - 行缓冲(用户换行) vs 块缓冲(磁盘上的 block，一般 4096 字节)
        - 两次拷贝，两次缓冲
          - 用户空间 -> stdio
          - stdio -> kernel
      - 实验
        - dd 测试写入性能
          
          [Alt text](ddWorkbench.png)

          - 写入大小是一样的
          - 一次写 1 字节要 1min
          - 一次写 1024 字节要 0.2 sec
          - 效率递增到 4096 后再增加块的大小就会递减，因为内核的缓存机制就是 4096 字节
    - 直接 IO
      - 最小化缓冲，无法屏蔽磁盘缓冲
      - O_DIRECT
  - 非阻塞 IO
    - open
      - 打开文件，依据 o_nonblock flag
    - fcntl
      - 设置文件为非阻塞